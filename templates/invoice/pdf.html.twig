<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Facture
			{{ invoice.invoiceNumber }}</title>
		<style>
			body {
				font-family: DejaVu Sans, sans-serif;
				font-size: 12px;
			}
			h1 {
				text-align: center;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 20px;
			}
			th,
			td {
				border: 1px solid #000;
				padding: 5px;
				text-align: left;
			}
			th {
				background-color: #eee;
			}
			tfoot td {
				font-weight: bold;
			}
			.right {
				text-align: right;
			}
		</style>
	</head>
	<body>
		<h1>Facture
			{{ invoice.invoiceNumber }}</h1>

		<p>
			<strong>Date :</strong>
			{{ invoice.issueDate|date('d/m/Y') }}</p>
		{% if invoice.paymentReference %}
			<p>
				<strong>Référence paiement :</strong>
				{{ invoice.paymentReference }}</p>
		{% endif %}

		<h2>Vendeur</h2>
		{% if invoice.seller %}
			<p>{{ invoice.seller.name ?? '' }}<br>
				{{ invoice.seller.address ?? '' }}<br>
				{{ invoice.seller.city ?? '' }}
				{{ invoice.seller.zip ?? '' }}<br>
				{{ invoice.seller.country ?? '' }}</p>
		{% else %}
			<p>Information vendeur non renseignée</p>
		{% endif %}

		<h2>Acheteur</h2>
		{% if invoice.buyer %}
			<p>{{ invoice.buyer.name ?? '' }}<br>
				{{ invoice.buyer.address ?? '' }}<br>
				{{ invoice.buyer.city ?? '' }}
				{{ invoice.buyer.zip ?? '' }}<br>
				{{ invoice.buyer.country ?? '' }}</p>
		{% else %}
			<p>Information acheteur non renseignée</p>
		{% endif %}

		<table>
			<thead>
				<tr>
					<th>Produit</th>
					<th>Description</th>
					<th>Quantité</th>
					<th>Prix unitaire</th>
					<th>TVA %</th>
					<th>Total</th>
				</tr>
			</thead>
			<tbody>
				{% set totalNet = 0 %}
				{% set totalTax = 0 %}
				{% for line in invoice.lines %}
					{% set lineTotal = line.netPrice * line.quantity %}
					{% set lineTax = line.taxRate is not null ? lineTotal * line.taxRate / 100 : 0 %}
					{% set totalNet = totalNet + lineTotal %}
					{% set totalTax = totalTax + lineTax %}
					<tr>
						<td>{{ line.productName }}</td>
						<td>{{ line.description ?? '' }}</td>
						<td class="right">{{ line.quantity }}</td>
						<td class="right">{{ line.netPrice|number_format(2, ',', ' ') }}
							{{ invoice.currency }}</td>
						<td class="right">{{ line.taxRate is not null ? line.taxRate ~ '%' : '-' }}</td>
						<td class="right">{{ (lineTotal + lineTax)|number_format(2, ',', ' ') }}
							{{ invoice.currency }}</td>
					</tr>
					{% if line.allowances %}
						<tr>
							<td colspan="6">
								<strong>Allowances / Charges :</strong>
								<ul>
									{% for a in line.allowances %}
										<li>{{ a.charge ? 'Charge' : 'Remise' }}
											:
											{{ a.amount }}
											{{ invoice.currency }}
											-
											{{ a.reason }}</li>
									{% endfor %}
								</ul>
							</td>
						</tr>
					{% endif %}
				{% endfor %}
			</tbody>
			<tfoot>
				<tr>
					<td colspan="5" class="right">Sous-total HT</td>
					<td class="right">{{ totalNet|number_format(2, ',', ' ') }}
						{{ invoice.currency }}</td>
				</tr>
				<tr>
					<td colspan="5" class="right">Total TVA</td>
					<td class="right">{{ totalTax|number_format(2, ',', ' ') }}
						{{ invoice.currency }}</td>
				</tr>
				<tr>
					<td colspan="5" class="right">Total TTC</td>
					<td class="right">{{ (totalNet + totalTax)|number_format(2, ',', ' ') }}
						{{ invoice.currency }}</td>
				</tr>
			</tfoot>
		</table>

		{% if invoice.note %}
			<p>
				<strong>Note :</strong>
				{{ invoice.note }}</p>
		{% endif %}

	</body>
</html>

